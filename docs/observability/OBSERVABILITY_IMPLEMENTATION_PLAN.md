# ResumeMatch Pro å¯è§‚æµ‹æ€§å®ç°è®¡åˆ’ï¼ˆMVP ç‰ˆæœ¬ï¼‰

## å¿«é€Ÿç´¢å¼•

- [ç¬¬ä¸€éƒ¨åˆ†ï¼šå‡†å¤‡å·¥ä½œ](#ç¬¬ä¸€éƒ¨åˆ†å‡†å¤‡å·¥ä½œ)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆPhase 1ï¼‰](#ç¬¬äºŒéƒ¨åˆ†åŸºç¡€è®¾æ–½æ­å»ºphase-1)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šåç«¯æ—¥å¿—å®ç°ï¼ˆPhase 2-3ï¼‰](#ç¬¬ä¸‰éƒ¨åˆ†åç«¯æ—¥å¿—å®ç°phase-2-3)
- [ç¬¬å››éƒ¨åˆ†ï¼šå‰ç«¯ç›‘æ§å®ç°ï¼ˆPhase 4ï¼‰](#ç¬¬å››éƒ¨åˆ†å‰ç«¯ç›‘æ§å®ç°phase-4)
- [ç¬¬äº”éƒ¨åˆ†ï¼šæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆPhase 5ï¼‰](#ç¬¬äº”éƒ¨åˆ†æµ‹è¯•ä¸æ–‡æ¡£phase-5)
- [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
- [æ–‡ä»¶ç»“æ„æ¦‚è§ˆ](#æ–‡ä»¶ç»“æ„æ¦‚è§ˆ)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šå‡†å¤‡å·¥ä½œ

### 1.1 Sentry è´¦æˆ·è®¾ç½®ï¼ˆç”¨æˆ·éœ€å®Œæˆï¼‰

**æ­¥éª¤ 1ï¼šæ³¨å†Œ Sentry è´¦æˆ·**
1. è®¿é—® https://sentry.io/
2. ç‚¹å‡» "Sign Up" æ³¨å†Œæ–°è´¦æˆ·
3. ä½¿ç”¨é‚®ç®±å’Œå¯†ç å®Œæˆæ³¨å†Œ

**æ­¥éª¤ 2ï¼šåˆ›å»ºé¡¹ç›®**
1. ç™»å½• Sentry åï¼Œç‚¹å‡» "Create Project"
2. é€‰æ‹© **Next.js** ä½œä¸ºå¹³å°
3. è®¾ç½®é¡¹ç›®åç§°ä¸º "ResumeMatch Pro"
4. å®Œæˆåˆ›å»º

**æ­¥éª¤ 3ï¼šè·å– DSN**
1. é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œä¼šçœ‹åˆ° Settings â†’ Client Keys (DSN)
2. å¤åˆ¶ DSNï¼Œæ ¼å¼å¦‚ï¼š`https://xxxxx@xxxxx.ingest.sentry.io/xxxxx`
3. ä¿å­˜å¥½ DSNï¼Œä¸‹ä¸€æ­¥éœ€è¦ç”¨

### 1.2 ç¯å¢ƒå˜é‡å‡†å¤‡

åœ¨ä½ çš„ `.env.local` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼ˆè¯¦è§ [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®) éƒ¨åˆ†ï¼‰

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆPhase 1ï¼‰

**æ—¶é—´é¢„æœŸï¼š2-3 å°æ—¶**

### 2.1 å®‰è£…å¿…è¦çš„ npm åŒ…

```bash
npm install @sentry/nextjs
# æˆ–
pnpm add @sentry/nextjs
```

### 2.2 åˆ›å»ºç±»å‹å®šä¹‰æ–‡ä»¶

**æ–‡ä»¶ä½ç½®ï¼š** `types/observability.ts`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- å®šä¹‰æ‰€æœ‰æ—¥å¿—äº‹ä»¶çš„ TypeScript ç±»å‹
- æ”¯æŒä¸åŒç±»å‹äº‹ä»¶çš„å­—æ®µè§„èŒƒï¼ˆbatch_match, scoring, details, upload ç­‰ï¼‰
- ç¡®ä¿ç±»å‹å®‰å…¨æ€§å’Œä»£ç è¡¥å…¨

### 2.3 åˆ›å»ºæ—¥å¿—ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼š** `lib/logging/logger.ts`

æ ¸å¿ƒåŠŸèƒ½ï¼š
- ç»Ÿä¸€çš„æ—¥å¿—è®°å½•å‡½æ•° `log(level, event, data)`
- è¾“å‡ºåˆ°ä¸¤ä¸ªç›®æ ‡ï¼š
  - **ç»ˆç«¯**ï¼šå®æ—¶æŸ¥çœ‹ï¼ˆconsole.log / console.errorï¼‰
  - **æœ¬åœ°æ–‡ä»¶**ï¼š`logs/app-development.log`ï¼ˆæŒä¹…åŒ–ï¼Œå¯è¢«å¿½ç•¥ï¼‰
- JSON æ ¼å¼æ¯è¡Œä¸€æ¡æ—¥å¿—ï¼ˆä¾¿äº grep å’Œ jq è§£æï¼‰
- ä»…åœ¨æœåŠ¡ç«¯è¿è¡Œï¼ˆä¸ä¼šåœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œï¼‰

**å…³é”®ç‰¹æ€§ï¼š**
- æ¯æ¬¡å†™å…¥æ—¥å¿—æ—¶æ£€æŸ¥å¹¶æŒ‰éœ€åˆ›å»º `logs/` ç›®å½•ï¼ˆæ€§èƒ½å¼€é”€æä½ï¼Œå¥å£®æ€§å¼ºï¼‰
- é”™è¯¯å¤„ç†ï¼ˆå¦‚æœæ–‡ä»¶å†™å…¥å¤±è´¥ï¼Œä¸ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼‰
- JSON æ ¼å¼æ¯è¡Œä¸€æ¡æ—¥å¿—ï¼Œä¾¿äº grep/jq è§£æ
- ç¬¦åˆæœªæ¥ AWS CloudWatch éƒ¨ç½²éœ€æ±‚

**ç›®å½•åˆ›å»ºé€»è¾‘ï¼š**
```typescript
// logger.ts ä¸­çš„å®ç°æ–¹å¼
function log(level, event, data) {
  const LOG_DIR = path.join(process.cwd(), 'logs');
  
  // æ¯æ¬¡è°ƒç”¨éƒ½æ£€æŸ¥ä¸€æ¬¡ï¼ˆæˆæœ¬å¯å¿½ç•¥ï¼‰
  if (!fs.existsSync(LOG_DIR)) {
    fs.mkdirSync(LOG_DIR, { recursive: true });
  }
  
  // ç„¶åå†™å…¥æ—¥å¿—...
}
```

ä¼˜ç‚¹ï¼š
- âœ… å¥å£®æ€§å¼ºï¼šå³ä½¿ç›®å½•è¢«åˆ é™¤ä¹Ÿèƒ½è‡ªåŠ¨æ¢å¤
- âœ… æ€§èƒ½å½±å“å¾®ä¹å…¶å¾®ï¼šfs.existsSync æ¯”ç½‘ç»œ I/O å¿«å¾—å¤š
- âœ… æ— éœ€ä¾èµ–å¯åŠ¨æ—¶æœºï¼šåªè¦è°ƒç”¨ log()ï¼Œå°±ä¿è¯ç›®å½•å­˜åœ¨

### 2.4 åˆ›å»º ID ç®¡ç†ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®ï¼ˆåç«¯ï¼‰ï¼š** `lib/logging/ids.ts`

åŠŸèƒ½ï¼š
- `generateRequestId()` - ç”Ÿæˆå”¯ä¸€çš„è¯·æ±‚ IDï¼ˆUUIDï¼‰
- `getAnonymousId(req)` - ä»è¯·æ±‚å¤´æå–åŒ¿åç”¨æˆ· ID

**æ–‡ä»¶ä½ç½®ï¼ˆå‰ç«¯ï¼‰ï¼š** `lib/analytics/ids.ts`

åŠŸèƒ½ï¼š
- `getOrCreateAnonymousId()` - ä» localStorage è·å–æˆ–åˆ›å»ºåŒ¿åç”¨æˆ· ID
- ä½¿ç”¨ `crypto.randomUUID()` ç”Ÿæˆ

### 2.5 åˆ›å»º Sentry é…ç½®æ–‡ä»¶

**æ–‡ä»¶ä½ç½®ï¼š** ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶éœ€åˆ›å»º

#### `sentry.client.config.ts`
- å®¢æˆ·ç«¯ Sentry åˆå§‹åŒ–
- è®¾ç½® DSNã€environmentã€tracesSampleRate

#### `sentry.server.config.ts`
- æœåŠ¡ç«¯ Sentry åˆå§‹åŒ–
- è®¾ç½®ç›¸åŒçš„ DSN å’Œç¯å¢ƒå˜é‡

#### `instrumentation.ts`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
- Next.js åˆå§‹åŒ–é’©å­
- åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–æœåŠ¡ç«¯ Sentry å’Œæ—¥å¿—ç³»ç»Ÿ
- æ³¨å†Œå…¨å±€é”™è¯¯å¤„ç†å™¨

### 2.6 æ›´æ–° .gitignore

æ·»åŠ ä»¥ä¸‹è¡Œï¼š
```
# æ—¥å¿—æ–‡ä»¶
logs/
*.log
```

### 2.7 æ£€æŸ¥é¡¹ç›®é…ç½®

ç¡®è®¤ `next.config.ts` ä¸­åŒ…å« Sentry çš„ webpack é…ç½®ï¼ˆé€šå¸¸è‡ªåŠ¨å¤„ç†ï¼‰

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šåç«¯æ—¥å¿—å®ç°ï¼ˆPhase 2-3ï¼‰

**æ—¶é—´é¢„æœŸï¼š3-4 å°æ—¶**

### 3.1 ä¿®æ”¹æ ¸å¿ƒ API è·¯ç”±

éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨ï¼š

| ä¼˜å…ˆçº§ | æ–‡ä»¶è·¯å¾„ | ç›‘æ§å†…å®¹ | æ—¥å¿—äº‹ä»¶ |
|------|---------|---------|---------|
| ğŸ”´ å¿…éœ€ | `app/api/match/batch/route.ts` | æ‰¹é‡åŒ¹é… | `batch_match_started` / `batch_match_completed` / `batch_match_failed` |
| ğŸ”´ å¿…éœ€ | `app/api/match/route.ts` | å•ä¸ªåŒ¹é… | `single_match_scoring_started` / `single_match_details_started` ç­‰ |
| ğŸŸ¡ æ¬¡ä¼˜å…ˆ | `app/api/resume/route.ts` | ç®€å†ä¸Šä¼  | `resume_upload_started` / `resume_upload_completed` / `resume_upload_failed` |

### 3.2 å®ç°æ‰¹é‡åŒ¹é…æ—¥å¿—ï¼ˆ/api/match/batchï¼‰

**æ·»åŠ ä»¥ä¸‹æ—¥å¿—äº‹ä»¶ï¼š**

1. **`batch_match_started`** - è¯·æ±‚å¼€å§‹
   ```typescript
   {
     requestId: "uuid",
     anonymousId: "from header",
     resumeId: "from body",
     jobCount: number
   }
   ```

2. **`batch_match_completed`** - è¯·æ±‚æˆåŠŸï¼ˆé‡ç‚¹ç»Ÿè®¡ï¼‰
   ```typescript
   {
     requestId,
     anonymousId,
     resumeId,
     jobCount,
     cachedJobs: number,         // ç¼“å­˜å‘½ä¸­æ•°
     computedJobs: number,       // éœ€é‡æ–°è®¡ç®—æ•°
     failedJobs: number,         // å¤±è´¥æ•°ï¼ˆå¦‚æœæœ‰éƒ¨åˆ†å®¹é”™ï¼‰
     cacheHitRate: number,       // ç¼“å­˜å‘½ä¸­ç‡ï¼ˆ0-1ï¼‰
     latencyMs: number,          // æ€»è€—æ—¶
     difyCallCount: number,      // è°ƒç”¨ Dify æ¬¡æ•°
     avgDifyLatencyMs: number    // å¹³å‡ Dify è€—æ—¶
   }
   ```

3. **`batch_match_failed`** - è¯·æ±‚å¤±è´¥
   ```typescript
   {
     requestId,
     anonymousId,
     resumeId,
     jobCount,
     error: "error message",
     latencyMs: number
   }
   ```

### 3.3 å®ç°å•ä¸ªåŒ¹é…æ—¥å¿—ï¼ˆ/api/matchï¼‰

**Scoring åˆ†æ”¯ï¼š**
- `single_match_scoring_started` - è¯·æ±‚å¼€å§‹
- `single_match_scoring_completed` - æˆåŠŸå®Œæˆï¼ˆæ ‡æ³¨ `fromCache` å­—æ®µï¼‰
- `single_match_scoring_failed` - å¤±è´¥

**Details åˆ†æ”¯ï¼ˆæ€§èƒ½ç“¶é¢ˆï¼‰ï¼š**
- `single_match_details_started` - è¯·æ±‚å¼€å§‹ï¼ŒåŒ…å« `overallScore` å‚æ•°
- `single_match_details_completed` - æˆåŠŸå®Œæˆï¼ˆæ ‡æ³¨ `fromCache`ï¼Œè®°å½• `difyLatencyMs`ï¼‰
- `single_match_details_failed` - å¤±è´¥

### 3.4 å®ç°ç®€å†ä¸Šä¼ æ—¥å¿—ï¼ˆ/api/resumeï¼‰

**æ—¥å¿—äº‹ä»¶ï¼š**
- `resume_upload_started` - åŒ…å« fileTypeã€fileSize
- `resume_upload_completed` - åŒ…å« resumeIdã€latencyMs
- `resume_upload_failed` - åŒ…å« error ä¿¡æ¯

### 3.5 å…¨å±€é”™è¯¯å¤„ç†å’Œ Sentry é›†æˆ

**åœ¨ `instrumentation.ts` ä¸­å®ç°ï¼š**

1. å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆPromise rejectionã€æœªæ•è·å¼‚å¸¸ï¼‰
2. è‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—å’Œ Sentry
3. å“åº”å¤´ç»Ÿä¸€è¿”å› `X-Request-Id`

**ä¿®æ”¹æ‰€æœ‰ API è·¯ç”±ï¼š**
- ä½¿ç”¨åŒ…è£…å™¨å‡½æ•°ç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æœ‰ `requestId`
- åœ¨å“åº”å¤´ä¸­è¿”å› `X-Request-Id`
- æ•è·å¼‚å¸¸æ—¶è‡ªåŠ¨ä¸ŠæŠ¥ Sentry

---

## ç¬¬å››éƒ¨åˆ†ï¼šå‰ç«¯ç›‘æ§å®ç°ï¼ˆPhase 4ï¼‰

**æ—¶é—´é¢„æœŸï¼š2.5-3 å°æ—¶**

### 4.1 åˆå§‹åŒ– Sentryï¼ˆapp/layout.tsxï¼‰

åœ¨æ ¹å¸ƒå±€ç»„ä»¶ä¸­ï¼š
1. å¯¼å…¥ Sentry é…ç½®
2. åˆå§‹åŒ– Sentry å®¢æˆ·ç«¯
3. è®¾ç½® `anonymousId` ä¸ºç”¨æˆ·æ ‡è¯†
4. é…ç½® Sentry ä¸Šä¸‹æ–‡

### 4.2 å®ç°åŒ¿åç”¨æˆ· ID ç³»ç»Ÿï¼ˆå‰ç«¯ï¼‰

**æ–‡ä»¶ï¼š** `lib/analytics/ids.ts`

åŠŸèƒ½ï¼š
- é¦–æ¬¡è®¿é—®ç”Ÿæˆ UUID å­˜å…¥ `localStorage["rm_anonymous_id"]`
- æ‰€æœ‰ API è¯·æ±‚æºå¸¦ `X-Anonymous-Id` å¤´éƒ¨
- ä½œä¸º Sentry çš„ `user.id`

### 4.3 ä½¿ç”¨ error.tsx å¤„ç†è·¯ç”±é”™è¯¯

**æ–‡ä»¶ï¼š** `app/error.tsx`ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰

ç”¨é€”ï¼š
- æ•è·è·¯ç”±æ®µåŠå­è·¯ç”±çš„æ¸²æŸ“é”™è¯¯
- æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ç•Œé¢
- é›†æˆ ErrorDisplay ç»„ä»¶

**æ³¨æ„ï¼š** å·²ç¡®è®¤ä½¿ç”¨ Next.js çš„ `error.tsx` æ›¿ä»£ä¼ ç»Ÿ React ErrorBoundary

### 4.4 å®ç°å…³é”® Breadcrumbsï¼ˆ5-6 ä¸ªï¼‰

åœ¨ç›¸åº”ä½ç½®æ·»åŠ  Sentry breadcrumbsï¼š

1. **ä¸Šä¼ ç®€å†**
   ```typescript
   Sentry.addBreadcrumb({
     category: 'resume',
     message: 'User uploaded resume',
     level: 'info',
     data: { fileType, fileSize }
   });
   ```

2. **æ‰¹é‡åŒ¹é…å¼€å§‹**
   ```typescript
   Sentry.addBreadcrumb({
     category: 'match',
     message: 'Batch match started',
     level: 'info',
     data: { jobCount }
   });
   ```

3. **æ‰¹é‡åŒ¹é…å®Œæˆ**ï¼ˆå¯é€‰ï¼‰
   ```typescript
   Sentry.addBreadcrumb({
     category: 'match',
     message: 'Batch match completed',
     level: 'info',
     data: { jobCount, duration: durationMs }
   });
   ```

4. **è¿›å…¥è¯¦æƒ…é¡µ**
   ```typescript
   Sentry.addBreadcrumb({
     category: 'navigation',
     message: 'Entered job details page',
     level: 'info',
     data: { jobId, hasScoringCache, hasDetailsCache }
   });
   ```

5. **Scoring è¯·æ±‚å¼€å§‹**
   ```typescript
   Sentry.addBreadcrumb({
     category: 'api',
     message: 'Single match scoring request started',
     level: 'info',
     data: { requestId, jobId }
   });
   ```

6. **Details è¯·æ±‚å¼€å§‹**ï¼ˆé‡ç‚¹ï¼‰
   ```typescript
   Sentry.addBreadcrumb({
     category: 'api',
     message: 'Single match details request started',
     level: 'info',
     data: { requestId, jobId, overallScore }
   });
   ```

### 4.5 API è°ƒç”¨å±‚é›†æˆ

**ä¿®æ”¹æˆ–åˆ›å»ºï¼š** `lib/fetcher.ts` æˆ–åˆ›å»º `lib/api/http-client.ts`

åŠŸèƒ½ï¼š
1. æ‰€æœ‰ API è¯·æ±‚è‡ªåŠ¨æ·»åŠ  `X-Anonymous-Id` å¤´éƒ¨
2. ä»å“åº”å¤´è¯»å– `X-Request-Id`
3. è¯·æ±‚å¤±è´¥æ—¶æ•è·å¼‚å¸¸åˆ° Sentryï¼ŒåŒ…å«ï¼š
   - `tags.requestId` - è¯·æ±‚ ID
   - `tags.endpoint` - API ç«¯ç‚¹
   - `extra.statusCode` - HTTP çŠ¶æ€ç 
   - `extra.anonymousId` - ç”¨æˆ· ID

### 4.6 é”™è¯¯å±•ç¤ºé›†æˆ

**å¤ç”¨ç°æœ‰ç»„ä»¶ï¼š** `components/common/ErrorDisplay.tsx`

ä¿®æ”¹ç°æœ‰çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä½¿ç”¨ ErrorDisplay ç»„ä»¶å±•ç¤ºï¼š
- é”™è¯¯æ ‡é¢˜
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **é”™è¯¯ç¼–å·**ï¼ˆrequestIdï¼‰ä¾›ç”¨æˆ·æˆªå›¾/å¤åˆ¶
- é‡è¯•æŒ‰é’®
- ä¸Šä¼ é¡µé¢é“¾æ¥ï¼ˆå¦‚é€‚ç”¨ï¼‰

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆPhase 5ï¼‰

**æ—¶é—´é¢„æœŸï¼š0.5-1 å°æ—¶**

### 5.1 æœ¬åœ°æ—¥å¿—æŸ¥è¯¢

åˆ›å»º `scripts/analyze-logs.js` è„šæœ¬ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/app-development.log

# æœç´¢æŸä¸ª requestId çš„å®Œæ•´é“¾è·¯
grep "req_abc123" logs/app-development.log | jq .

# ç»Ÿè®¡æ‰¹é‡åŒ¹é…çš„å¹³å‡ç¼“å­˜å‘½ä¸­ç‡
grep "batch_match_completed" logs/app-development.log | \
  jq '.cacheHitRate' | \
  awk '{sum+=$1; count++} END {print "å¹³å‡ç¼“å­˜å‘½ä¸­ç‡: " sum/count*100 "%"}'

# ç»Ÿè®¡é”™è¯¯ç‡
jq 'select(.level=="error")' logs/app-development.log | wc -l

# æŸ¥çœ‹å„äº‹ä»¶ç±»å‹çš„ç»Ÿè®¡
jq -r '.event' logs/app-development.log | sort | uniq -c
```

### 5.2 æµ‹è¯•åœºæ™¯

**æµ‹è¯•æ¸…å•ï¼š**

- [ ] ä¸Šä¼ ç®€å†ï¼ˆè§‚å¯Ÿæ—¥å¿—ä¸­æ˜¯å¦æœ‰ `resume_upload_*` äº‹ä»¶ï¼‰
- [ ] æ‰¹é‡åŒ¹é… - å…¨ç¼“å­˜ï¼ˆè§‚å¯Ÿ `cacheHitRate: 1.0`ï¼‰
- [ ] æ‰¹é‡åŒ¹é… - å…¨è®¡ç®—ï¼ˆè§‚å¯Ÿ `cachedJobs: 0, computedJobs: n`ï¼‰
- [ ] å•ä¸ªåŒ¹é… - Scoring ç¼“å­˜å‘½ä¸­ï¼ˆè§‚å¯Ÿ `fromCache: true, latencyMs < 100`ï¼‰
- [ ] å•ä¸ªåŒ¹é… - Scoring éœ€è®¡ç®—ï¼ˆè§‚å¯Ÿ `fromCache: false, latencyMs < 5000`ï¼‰
- [ ] å•ä¸ªåŒ¹é… - Details ç¼“å­˜å‘½ä¸­ï¼ˆè§‚å¯Ÿ `fromCache: true, latencyMs < 100`ï¼‰
- [ ] å•ä¸ªåŒ¹é… - Details éœ€è®¡ç®—ï¼ˆè§‚å¯Ÿ `fromCache: false, latencyMs: 10000-60000`ï¼‰
- [ ] åˆ¶é€ ä¸€ä¸ª API é”™è¯¯ï¼ˆéªŒè¯ Sentry æ˜¯å¦æ”¶åˆ°ï¼‰
- [ ] åˆ¶é€ ä¸€ä¸ªè·¯ç”±æ¸²æŸ“é”™è¯¯ï¼ˆéªŒè¯ error.tsx æ˜¯å¦æ•è·ï¼‰

### 5.3 Sentry éªŒè¯

1. ç™»å½• Sentry é¡¹ç›®
2. æ£€æŸ¥ "Issues" é¡µé¢æ˜¯å¦æ”¶åˆ°é”™è¯¯äº‹ä»¶
3. éªŒè¯é”™è¯¯ä¸­æ˜¯å¦åŒ…å«ï¼š
   - `anonymousId`ï¼ˆuser.idï¼‰
   - `requestId`ï¼ˆtagsï¼‰
   - breadcrumbs é“¾è·¯
4. å°è¯•ä» requestId åå‘æŸ¥è¯¢æœ¬åœ°æ—¥å¿—æ–‡ä»¶

---

## ç¯å¢ƒå˜é‡é…ç½®

### éœ€è¦åœ¨ .env.local ä¸­æ·»åŠ çš„å˜é‡

```env
# Sentry å‰ç«¯ DSNï¼ˆä» Sentry é¡¹ç›®ä¸­å¤åˆ¶ï¼‰
NEXT_PUBLIC_SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx

# åº”ç”¨ç¯å¢ƒ
NODE_ENV=development

# æ€§èƒ½ç›‘æ§é‡‡æ ·ç‡ï¼ˆå¼€å‘ç¯å¢ƒå»ºè®® 0.5ï¼Œç”Ÿäº§ç¯å¢ƒæ”¹ä¸º 0.1ï¼‰
NEXT_PUBLIC_SENTRY_TRACES_SAMPLE_RATE=0.5

# ï¼ˆå¯é€‰ï¼‰æ—¥å¿—çº§åˆ«ï¼ˆå¦‚æœä½ çš„æ—¥å¿—ç³»ç»Ÿéœ€è¦é…ç½®ï¼‰
LOG_LEVEL=info
```

### è¯´æ˜

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | å¿…éœ€ | é»˜è®¤å€¼ | æ¨èå€¼ï¼ˆå¼€å‘ï¼‰ |
|---------|------|------|--------|--------------|
| `NEXT_PUBLIC_SENTRY_DSN` | Sentry é¡¹ç›® DSN | âœ“ | - | - |
| `NODE_ENV` | åº”ç”¨ç¯å¢ƒï¼ˆdevelopment/productionï¼‰ | âœ“ | - | development |
| `NEXT_PUBLIC_SENTRY_TRACES_SAMPLE_RATE` | æ€§èƒ½ç›‘æ§é‡‡æ ·ç‡ï¼ˆ0-1ï¼‰ | âœ— | 0.1 | **0.5**ï¼ˆå……åˆ†æ”¶é›†æ•°æ®ç”¨äºæ¼”ç¤ºï¼‰ |
| `LOG_LEVEL` | æ—¥å¿—çº§åˆ« | âœ— | info | info |

**é‡‡æ ·ç‡è¯´æ˜ï¼š**
- **å¼€å‘ç¯å¢ƒ**ï¼šè®¾ç½®ä¸º `0.5`ï¼ˆ50%ï¼‰â€” å……åˆ†æ”¶é›†æ€§èƒ½æ•°æ®ç”¨äºæ¼”ç¤ºå’Œè°ƒè¯•
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ”¹ä¸º `0.1`ï¼ˆ10%ï¼‰â€” å¹³è¡¡æˆæœ¬å’Œæ•°æ®è´¨é‡
- é‡‡æ ·ç‡ä»…å½±å“ Sentry çš„æ€§èƒ½ç›‘æ§ï¼ˆTracesï¼‰ï¼Œä¸å½±å“æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼ˆ100% è®°å½•ï¼‰å’Œé”™è¯¯æ•è·

### è·å– Sentry DSN

1. ç™»å½• Sentry: https://sentry.io/
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. å¯¼èˆªåˆ° **Settings** â†’ **Client Keys (DSN)**
4. å¤åˆ¶æ˜¾ç¤ºçš„ DSN URL
5. ç²˜è´´åˆ° `.env.local` ä¸­çš„ `NEXT_PUBLIC_SENTRY_DSN`

---

## æ–‡ä»¶ç»“æ„æ¦‚è§ˆ

å®ç°å®Œæˆåï¼Œé¡¹ç›®ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```
resume_match_pro/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx                    # ä¿®æ”¹ï¼šåˆå§‹åŒ– Sentry
â”‚   â”œâ”€â”€ error.tsx                     # æ–°å¢/ä¿®æ”¹ï¼šè·¯ç”±é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ match/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts              # ä¿®æ”¹ï¼šæ·»åŠ æ—¥å¿—
â”‚   â”‚   â”‚   â””â”€â”€ batch/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts          # ä¿®æ”¹ï¼šæ·»åŠ è¯¦ç»†æ—¥å¿—ç»Ÿè®¡
â”‚   â”‚   â””â”€â”€ resume/
â”‚   â”‚       â””â”€â”€ route.ts              # ä¿®æ”¹ï¼šæ·»åŠ æ—¥å¿—
â”‚   â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ logging/
â”‚   â”‚   â”œâ”€â”€ logger.ts                 # æ–°å¢ï¼šæ ¸å¿ƒæ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ids.ts                    # æ–°å¢ï¼šåç«¯ ID ç”Ÿæˆ
â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â””â”€â”€ ids.ts                    # æ–°å¢ï¼šå‰ç«¯åŒ¿åç”¨æˆ· ID
â”‚   â”œâ”€â”€ fetcher.ts                    # ä¿®æ”¹ï¼šAPI è°ƒç”¨é›†æˆ
â”‚   â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
â”‚
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ observability.ts              # æ–°å¢ï¼šæ—¥å¿—ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ matching.ts                   # ç°æœ‰
â”‚   â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ ErrorDisplay.tsx          # ç°æœ‰ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
â”‚   â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ analyze-logs.js               # æ–°å¢ï¼šæ—¥å¿—åˆ†æè„šæœ¬
â”‚
â”œâ”€â”€ logs/                             # æ–°å¢ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ app-development.log           # è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆ
â”‚
â”œâ”€â”€ sentry.client.config.ts           # æ–°å¢ï¼šå®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ sentry.server.config.ts           # æ–°å¢ï¼šæœåŠ¡ç«¯é…ç½®
â”œâ”€â”€ instrumentation.ts                # æ–°å¢ï¼šå¯åŠ¨é’©å­
â”œâ”€â”€ next.config.ts                    # ç°æœ‰ï¼ˆæ— éœ€æ”¹åŠ¨ï¼‰
â”œâ”€â”€ package.json                      # ä¿®æ”¹ï¼šæ·»åŠ  @sentry/nextjs
â”œâ”€â”€ .env.local                        # ä¿®æ”¹ï¼šæ·»åŠ ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore                        # ä¿®æ”¹ï¼šæ·»åŠ  logs/
â””â”€â”€ [å…¶ä»–ç°æœ‰æ–‡ä»¶]
```

### æ–°å¢æ–‡ä»¶æ±‡æ€»

| æ–‡ä»¶è·¯å¾„ | ç±»å‹ | ç”¨é€” |
|---------|------|------|
| `lib/logging/logger.ts` | âœ¨ æ–°å¢ | ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ |
| `lib/logging/ids.ts` | âœ¨ æ–°å¢ | åç«¯ ID ç®¡ç† |
| `lib/analytics/ids.ts` | âœ¨ æ–°å¢ | å‰ç«¯åŒ¿åç”¨æˆ· ID |
| `types/observability.ts` | âœ¨ æ–°å¢ | TypeScript ç±»å‹å®šä¹‰ |
| `sentry.client.config.ts` | âœ¨ æ–°å¢ | Sentry å®¢æˆ·ç«¯é…ç½® |
| `sentry.server.config.ts` | âœ¨ æ–°å¢ | Sentry æœåŠ¡ç«¯é…ç½® |
| `instrumentation.ts` | âœ¨ æ–°å¢ | Next.js åˆå§‹åŒ–é’©å­ |
| `app/error.tsx` | âœ¨ æ–°å¢/ä¿®æ”¹ | è·¯ç”±é”™è¯¯å¤„ç† |
| `scripts/analyze-logs.js` | âœ¨ æ–°å¢ | æ—¥å¿—åˆ†æå·¥å…· |

### ä¿®æ”¹æ–‡ä»¶æ±‡æ€»

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|---------|---------|
| `app/layout.tsx` | å¯¼å…¥å’Œåˆå§‹åŒ– Sentry |
| `lib/fetcher.ts` | æ·»åŠ  `X-Anonymous-Id` å¤´éƒ¨ï¼Œè¯»å– `X-Request-Id` |
| `app/api/match/batch/route.ts` | æ·»åŠ æ‰¹é‡åŒ¹é…æ—¥å¿—ç»Ÿè®¡ |
| `app/api/match/route.ts` | æ·»åŠ å•ä¸ªåŒ¹é…æ—¥å¿— |
| `app/api/resume/route.ts` | æ·»åŠ ç®€å†ä¸Šä¼ æ—¥å¿— |
| `package.json` | æ·»åŠ  `@sentry/nextjs` ä¾èµ– |
| `.env.local` | æ·»åŠ  `NEXT_PUBLIC_SENTRY_DSN` ç­‰ç¯å¢ƒå˜é‡ |
| `.gitignore` | æ·»åŠ  `logs/` å’Œ `*.log` |

---

## å…³é”®è®¾è®¡å†³ç­–æ€»ç»“

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ error.tsx è€Œé React ErrorBoundaryï¼Ÿ

- âœ“ **error.tsx**ï¼šNext.js App Router åŸç”Ÿæ”¯æŒï¼Œè‡ªåŠ¨åŒ…è£…åœ¨ Error Boundary ä¸­
- âœ“ è·¯ç”±çº§åˆ«çš„é”™è¯¯å¤„ç†ï¼Œç¬¦åˆ Next.js æœ€ä½³å®è·µ
- âœ“ ä¸ Sentry çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç›¸ç»“åˆï¼Œè¦†ç›–æ‰€æœ‰é”™è¯¯ç±»å‹

### 2. ä¸ºä»€ä¹ˆæœ¬åœ°å¼€å‘é˜¶æ®µè¾“å‡ºåˆ°æ–‡ä»¶ï¼Ÿ

- ç»ˆç«¯æ—¥å¿—é‡å¯å³ä¸¢å¤±ï¼Œæœ¬åœ°æ–‡ä»¶å¯æŒä¹…åŒ–
- JSON æ ¼å¼ä¾¿äºç”¨ grep/jq å·¥å…·å¿«é€ŸæŸ¥è¯¢
- å¼€å‘æˆæœ¬ä½ï¼ˆ1 å°æ—¶å®ç°ï¼‰ï¼Œæ”¶ç›Šé«˜ï¼ˆç«‹å³è§£å†³æ’æŸ¥ç—›ç‚¹ï¼‰
- éƒ¨ç½²åˆ° AWS CloudWatch åï¼Œæ—¥å¿—æ ¼å¼æ— éœ€æ”¹å˜

### 3. ä¸ºä»€ä¹ˆæ ‡è¯†ä½“ç³»è®¾è®¡ä¸º anonymousId + requestIdï¼Ÿ

- **anonymousId**ï¼ˆæµè§ˆå™¨çº§ï¼‰ï¼šè¿½è¸ªåŒä¸€ç”¨æˆ·çš„è¡Œä¸ºåºåˆ—ï¼Œä½œä¸º Sentry user.id
- **requestId**ï¼ˆè¯·æ±‚çº§ï¼‰ï¼šç²¾ç¡®å®šä½å•æ¬¡æ“ä½œï¼Œå‰åç«¯å…³è”æŸ¥è¯¢çš„é’¥åŒ™
- **sessionId**ï¼ˆä¼šè¯çº§ï¼‰ï¼šMVP é˜¶æ®µæš‚ç¼“ï¼Œæœªæ¥åœ¨å¢å¼ºç‰ˆä¸­è¡¥å……

### 4. instrumentation.ts çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

- Next.js åº”ç”¨å¯åŠ¨æ—¶çš„åˆå§‹åŒ–é’©å­
- åœ¨æœåŠ¡ç«¯æ³¨å†Œå…¨å±€é”™è¯¯å¤„ç†ã€Sentry åˆå§‹åŒ–ã€æ—¥å¿—ç³»ç»Ÿå¯åŠ¨
- ç¡®ä¿ä»åº”ç”¨å¯åŠ¨çš„ç¬¬ä¸€æ—¶åˆ»å°±å¼€å§‹ç›‘æ§

### 5. ä¸ºä»€ä¹ˆé€‰æ‹©è‡ªå»ºæ—¥å¿—ç³»ç»Ÿè€Œä¸æ˜¯ winston/pinoï¼Ÿ

æœ¬é¡¹ç›®é‡‡ç”¨**è‡ªå»ºè½»é‡æ—¥å¿—ç³»ç»Ÿ**è€Œéç¬¬ä¸‰æ–¹åº“ï¼ˆwinston/pino ç­‰ï¼‰çš„åŸå› ï¼š

| ç»´åº¦ | è‡ªå»ºæ–¹æ¡ˆ | ç¬¬ä¸‰æ–¹åº“ |
|------|---------|---------|
| ä»£ç å¤æ‚åº¦ | ç®€å•ï¼Œå‡ ç™¾è¡Œä»¥å†… | é…ç½®ç¹çï¼ŒåŠŸèƒ½å†—ä½™ |
| ä¾èµ–é£é™© | æ— æ–°å¢ä¾èµ– | ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ |
| åœºæ™¯é€‚é… | å®Œå…¨æ»¡è¶³ MVP éœ€æ±‚ï¼ˆæœ¬åœ°æ–‡ä»¶ + æ§åˆ¶å°ï¼‰ | è¿‡åº¦è®¾è®¡ï¼Œè®¸å¤šç‰¹æ€§ç”¨ä¸ä¸Š |
| è¿ç§»æˆæœ¬ | ä½ï¼›CloudWatch éƒ¨ç½²æ—¶åªéœ€æ”¹å†™è¾“å‡ºé€»è¾‘ | ä¸­ç­‰ï¼›éœ€è¦é‡æ–°é…ç½® transport |
| é¢è¯•ä»·å€¼ | ä½“ç°å·¥ç¨‹è®¾è®¡èƒ½åŠ›ï¼Œå±•ç¤ºæŠ€æœ¯åˆ¤æ–­åŠ› | ä»…æ˜¯"ä½¿ç”¨æ ‡å‡†åº“" |

**ä½•æ—¶è€ƒè™‘è¿ç§»åˆ°ç¬¬ä¸‰æ–¹åº“ï¼š**
- éœ€è¦åŠ¨æ€é…ç½®æ—¥å¿—çº§åˆ«
- éœ€è¦å¤šç§è¾“å‡ºç›®æ ‡ï¼ˆKafkaã€Elasticã€CloudWatch åŸç”Ÿ APIï¼‰
- éœ€è¦æ€§èƒ½ä¼˜åŒ–ï¼ˆæ—¥å¿—ååé‡ > 1000/sï¼‰

---

## æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ |
|------|------|------|
| Phase 1 | åŸºç¡€è®¾æ–½æ­å»ºï¼ˆnpm åŒ…ã€ç±»å‹ã€loggerã€Sentry é…ç½®ï¼‰ | 2-3h |
| Phase 2-3 | åç«¯æ—¥å¿—å®ç°ï¼ˆæ‰¹é‡/å•ä¸ª/ä¸Šä¼  API æ—¥å¿—ç»Ÿè®¡ï¼‰ | 3-4h |
| Phase 4 | å‰ç«¯ç›‘æ§å®ç°ï¼ˆSentry åˆå§‹åŒ–ã€breadcrumbsã€API é›†æˆï¼‰ | 2.5-3h |
| Phase 5 | æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆæµ‹è¯•åœºæ™¯ã€log åˆ†æè„šæœ¬ï¼‰ | 0.5-1h |
| **æ€»è®¡** | MVP å®Œæ•´å®ç° | **8.5-11h** |

---

## åç»­æ­¥éª¤

1. âœ… **æœ¬é˜¶æ®µï¼ˆPhase 1ï¼‰**ï¼šåŸºç¡€è®¾æ–½æ­å»º + ç”¨æˆ·ç¡®è®¤
2. ğŸ“‹ **ä¸‹ä¸€é˜¶æ®µ**ï¼šå®ç°åç«¯æ—¥å¿—ï¼ˆä¿®æ”¹ API è·¯ç”±ï¼‰
3. ğŸ“‹ **å†ä¸‹ä¸€é˜¶æ®µ**ï¼šå®ç°å‰ç«¯ç›‘æ§ï¼ˆSentry + breadcrumbsï¼‰
4. ğŸ“‹ **æœ€åé˜¶æ®µ**ï¼šæµ‹è¯•ä¸æ–‡æ¡£å®Œå–„

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q: æ—¥å¿—æ–‡ä»¶ä¼šæ— é™å¢é•¿å—ï¼Ÿ

A: æœ¬åœ°å¼€å‘é˜¶æ®µä¼šæŒç»­å¢é•¿ã€‚å»ºè®®ï¼š
- å®šæœŸæ¸…ç† `logs/app-development.log`ï¼ˆ`rm logs/app-development.log`ï¼‰
- æˆ–åœ¨ `.gitignore` ä¸­å¿½ç•¥æ—¥å¿—æ–‡ä»¶ï¼ˆå·²é…ç½®ï¼‰
- éƒ¨ç½²åˆ° CloudWatch åï¼Œæ—¥å¿—è‡ªåŠ¨æŒ‰æ—¶é—´åˆ†ç‰‡

### Q: å¦‚æœ Sentry è´¦æˆ·æœªè®¾ç½®å¥½ï¼Œèƒ½å…ˆä¸ç”¨å—ï¼Ÿ

A: å¯ä»¥ã€‚Sentry åˆå§‹åŒ–å¤±è´¥ä¸ä¼šå¯¼è‡´åº”ç”¨å´©æºƒï¼Œåªæ˜¯æ— æ³•ä¸ŠæŠ¥å‰ç«¯é”™è¯¯ã€‚æ—¥å¿—ç³»ç»Ÿï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰ä¸ä¾èµ– Sentryï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚

### Q: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒç¦ç”¨æœ¬åœ°æ–‡ä»¶è¾“å‡ºï¼Ÿ

A: åœ¨ `logger.ts` ä¸­æ·»åŠ ç¯å¢ƒæ£€æŸ¥ï¼š
```typescript
if (process.env.NODE_ENV === 'production') {
  // ä»…è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸è¾“å‡ºåˆ°æ–‡ä»¶
  // ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è‡ªåŠ¨è¿›å…¥ CloudWatch
}
```

### Q: error.tsx çš„ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆï¼Ÿ

A: æ•è·é¡ºåºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. è·¯ç”±æ®µå†…çš„é”™è¯¯ â†’ `app/[segment]/error.tsx`
2. å…¶ä»–æ‰€æœ‰é”™è¯¯ â†’ `app/error.tsx`ï¼ˆå…¨å±€ï¼‰
3. Sentry å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆä½œä¸ºæœ€åé˜²çº¿ï¼‰

### Q: å¼€å‘ç¯å¢ƒä¸ºä»€ä¹ˆé‡‡æ ·ç‡è®¾ä¸º 0.5ï¼Ÿ

A: 
- **0.5ï¼ˆ50%ï¼‰** èƒ½å……åˆ†æ”¶é›†æ€§èƒ½æ•°æ®ç”¨äºæ¼”ç¤ºå’Œè°ƒè¯•
- é¿å… 100% é‡‡æ ·å¯¼è‡´æ•°æ®çˆ†ç‚¸
- è¶³ä»¥è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼ˆå¦‚ Details 10-60sï¼‰
- ç”Ÿäº§éƒ¨ç½²æ—¶å¯æ”¹ä¸º 0.1ï¼ˆ10%ï¼‰ä»¥é™ä½æˆæœ¬
- é‡‡æ ·ç‡åªå½±å“ Sentry æ€§èƒ½ç›‘æ§ï¼Œä¸å½±å“æœ¬åœ°æ—¥å¿—æ–‡ä»¶ï¼ˆ100% è®°å½•ï¼‰

---

## ç›¸å…³æ–‡æ¡£å‚è€ƒ

- åŸå§‹è®¾è®¡æ–‡æ¡£ï¼š`OBSERVABILITY_DESIGN.md`
- æ—¥å¿—ç­–ç•¥è¯¦è§£ï¼š`LOGGING_STRATEGY.md`
- Sentry å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.sentry.io/platforms/javascript/guides/nextjs/
- Next.js é”™è¯¯å¤„ç†ï¼šhttps://nextjs.org/docs/app/building-your-application/routing/error-handling

